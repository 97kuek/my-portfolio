---
title: XFLR5の解析結果からXROTORのパラメータを自動算出するツールを作った話
description: 'AEROSECTIONのパラメータ設定方法'
pubDate: '2025-12-17'
tags: ['設計', '人力飛行機', '技術解説', 'XROTOR', 'XFLR5']
---

こんにちは。早稲田大学宇宙航空研究会（WASA）鳥人間プロジェクトで翼班をやっている植木です。
普段は主翼や尾翼の製作がメインですが、最近はプロペラ設計のサポートも行っています。

人力飛行機のプロペラ設計において、**XROTOR** は避けて通れないデファクトスタンダードなツールです。しかし、そのパラメータ設定（特に `AEROSECTION`）は、設計者の「勘」や「経験」に依存する部分が多く、属人化しやすいという課題がありました。

そこで今回、**XFLR5の解析データからXROTORに必要なパラメータを理論的に算出し、自動生成するPythonスクリプト**を開発しました。
今回はそのアルゴリズムと実装の裏側について共有します。

[ソースコード](https://github.com/97kuek/xflr5-to-xrotor-converter)

![プロペラ](../../assets/propeller.jpg)
*25年度鳥人間コンテストのプロペラの写真，かっこいい！*

### 背景：XROTORの「職人芸」をなくしたい

XROTOR（by Mark Drela, MIT）は、低レイノルズ数領域において非常に強力なプロペラ設計・解析ツールです。
しかし、そのコアとなる翼型定義（AEROSECTION）では、以下のような物理パラメータを数値で入力する必要があります。

* \alpha_{C_L=0}（ゼロ揚力角）
* dC_L/d\alpha（揚力傾斜）
* C_{D,min}（最小抗力係数）
* ...など計13項目

これらは通常、XFLR5などで解析したグラフを目視で読み取ったり、定規を当てて傾きを測ったりして入力されます。しかし、**「どこからどこまでを線形とみなすか」「放物線のフィッティングをどうするか」**によって値がブレてしまい、再現性が低いのが悩みでした。

**「データがあるなら、最小二乗法で一意に決まるはずだ」**

そう考え、Python（pandas + scipy）で自動化することにしました。

### アルゴリズムの設計

XFLR5が出力する離散データ（CSV）を、XROTORが内部で持つ数学モデル（連続関数）にマッピングする処理を行います。

#### 1. データの前処理：線形領域のフィルタリング

揚力曲線（C_L-\alpha）の傾きを求める際、失速域のデータが混ざると精度が落ちます。そこで、ドラッグポーラーの局所的な傾き s_i を評価関数として利用しました。

低レイノルズ数領域では、剥離が始まると抗力が急増します。今回は経験則に基づき、\left| s_i \right| < 0.05 を満たす区間を**「流れが安定している線形領域」**として抽出するフィルタを実装しました。

#### 2. 抗力モデルの推定（2次多項式フィッティング）

XROTORは抗力を以下のモデルで扱います。

これは C_L に関する二次関数です。そこで、抽出した線形領域のデータセット (C_L, C_D) に対して `numpy.polyfit` 等を用いて以下の2次多項式近似を行います。

この回帰係数 (a, b, c) が求まれば、XROTORに必要なパラメータは解析的に導出できます。

* **抗力の広がり係数**: a がそのまま d(C_D)/d(C_L^2) に相当
* **最適揚力係数 (C_{L,opt})**: 頂点のX座標 \rightarrow -b / 2a
* **最小抗力係数 (C_{D,min})**: 頂点のY座標 \rightarrow c - b^2 / 4a

これにより、目視でグラフの底を探す作業から解放されます。

#### 3. 揚力モデルの推定（有限差分法）

揚力傾斜についても、全データを回帰するのではなく、**「最も抗力が小さい点（＝最も流れが綺麗な点）」**近傍の2点を用いた有限差分を採用しました。
これにより、ポテンシャル流理論に近い、かつ粘性の影響（Boundary Layer Decambering）を含んだ実用的な傾きが得られます。

### 実装とソースコード

作成したツールはGitHubで公開しています。

**[GitHub: xflr5-to-xrotor-converter](https://github.com/97kuek/xflr5-to-xrotor-converter)**

#### 技術スタック

* **Python 3.11**
* **pandas**: CSVの読み込みとデータフレーム操作
* **scipy / numpy**: 最小二乗法フィッティングと数値計算

使い方はシンプルで、XFLR5からエクスポートしたCSVを `input` フォルダに入れてスクリプトを叩くだけです。

```bash
$ python main.py
Processing: input/DAE51.csv
--------------------------------------------------
[Lift Parameters]
Zero Lift Alpha : -2.14 deg
Lift Slope      : 6.12 /rad
Max CL          : 1.45

[Drag Parameters]
Min Drag (CDmin): 0.0084
CL at min Drag  : 0.55
...

```

このように、AEROSECTIONに必要な値がコンソールに出力されます。

### まとめ

プロペラ設計のようなパラメトリックな作業において、**「入力値の根拠」**を明確にすることは非常に重要です。
今回のツール作成により、以下のメリットが得られました。

1. **工数削減**: CSVを置くだけで設定値が出るため、試行錯誤のサイクルが高速化した。
2. **再現性の確保**: 誰がやっても同じ値が出るため、設計品質が安定した。
3. **属人化の解消**: 「先輩の秘伝のタレ」的なパラメータ設定を廃止できた。

もし他大学のBirdmanチームの方や、模型飛行機の設計をされている方がいれば、ぜひ使ってみてください。Pull Requestもお待ちしています！